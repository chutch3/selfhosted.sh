# Test fixture for homelab.yaml structure
# Used by unit tests to avoid dependency on real config files
version: "2.0"
deployment: docker_compose

environment:
  BASE_DOMAIN: test.local
  PROJECT_ROOT: /tmp/test-homelab
  TIMEZONE: UTC

machines:
  driver:
    host: localhost
    user: testuser
    role: manager
    labels:
      - storage=ssd
      - gpu=none
  node-01:
    host: 192.168.1.101
    user: testuser
    role: worker
    labels:
      - storage=hdd

services:
  # Test service with full configuration
  actual:
    name: "Actual Budget"
    description: "Personal finance application"
    category: finance
    image: actualbudget/actual-server:latest
    port: 5006
    domain: budget
    storage: 5GB
    deploy: driver
    enabled: true
    environment:
      DEBUG: "actual:config"
    nginx:
      upstream: "actual:5006"
      additional_config: |
        location / {
            proxy_pass http://actual:5006;
            proxy_set_header Host $host;
        }
    compose:
      restart: unless-stopped
      volumes:
        - "/data/actual:/app/data"

  # Simple service for basic testing
  homepage:
    name: "Homepage"
    description: "Application dashboard"
    category: dashboard
    image: ghcr.io/gethomepage/homepage:latest
    port: 3000
    domain: home
    deploy: driver
    enabled: true
    nginx:
      upstream: "homepage:3000"

  # Service with complex configuration
  homeassistant:
    name: "Home Assistant"
    description: "Smart home automation"
    category: automation
    image: ghcr.io/home-assistant/home-assistant:stable
    port: 8123
    domain: ha
    storage: 10GB
    deploy: node-01
    enabled: false
    environment:
      TZ: "America/New_York"
    nginx:
      upstream: "homeassistant:8123"
      additional_config: |
        proxy_buffering off;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

  # Infrastructure service
  nginx:
    name: "Nginx Reverse Proxy"
    description: "Load balancer and reverse proxy"
    category: infrastructure
    image: nginx:alpine
    ports: [80, 443]
    deploy: all
    enabled: true

  # Disabled service for testing
  portainer:
    name: "Portainer"
    description: "Docker management UI"
    category: management
    image: portainer/portainer-ce:latest
    port: 9000
    domain: docker
    storage: true
    deploy: driver
    enabled: false
